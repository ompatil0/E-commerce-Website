<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shop - Krushna super shopee</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    /* Sidebar Cart */
    .cart-sidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 350px;
      height: 100vh;
      background: #fff;
      box-shadow: -5px 0 15px rgba(0,0,0,0.1);
      transition: right 0.3s ease;
      padding: 20px;
      overflow-y: auto;
      z-index: 999;
    }
    .cart-sidebar.open { right: 0; }
    .cart-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ddd; margin-bottom: 15px; }
    .cart-item { display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #eee; padding: 10px 0; }
    .cart-item img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; margin-right: 10px; }
    .cart-total { border-top: 2px solid #ddd; padding-top: 10px; margin-top: 10px; display: flex; justify-content: space-between; font-weight: bold; }
    .checkout-btn { background: #198754; color: #fff; width: 100%; border: none; padding: 10px; margin-top: 15px; border-radius: 5px; font-weight: 600; }
    .checkout-btn:hover { background: #157347; }
    .cart-close { cursor: pointer; color: #333; font-size: 20px; }
  </style>
</head>
<body>

  <!-- Header -->
  <section id="header" class="p-3 bg-light shadow-sm">
    <div class="container d-flex justify-content-between align-items-center">
      <a href="#"><img src="Krushna super shopee new logo.jpeg" height="50px" width="170px" class="logo" alt="J&N MART Logo"></a>
      <ul class="nav">
        <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
        <li class="nav-item"><a href="shop.html" class="nav-link active fw-bold text-success">Shop</a></li>
        <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
        <li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li>
        <li class="nav-item"><a href="login.html" class="nav-link"><i class="fa-solid fa-user"></i></a></li>
        <li class="nav-item">
          <div id="cartBtn" class="position-relative" style="cursor:pointer;">
            <i class="fa-solid fa-cart-shopping fs-5"></i>
            <span id="count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success">0</span>
          </div>
        </li>
      </ul>
    </div>
  </section>

  <!-- Products -->
  <section class="container my-5">
    <h2 class="mb-4 text-center">Our Latest Products</h2>
    <div id="productList" class="row g-4 justify-content-center"></div>
  </section>

  <!-- Sidebar Cart -->
  <div class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
      <h4>My Cart</h4>
      <span id="closeCart" class="cart-close"><i class="fa-solid fa-xmark"></i></span>
    </div>
    <div id="cartItem"></div>
    <div class="cart-total">
      <span>Total:</span>
      <span id="total">₹0</span>
    </div>
    <button class="checkout-btn" onclick="checkout()">Checkout</button>
  </div>

  <!-- Checkout Modal -->
  <div class="modal fade" id="checkoutModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">Checkout Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="checkoutForm">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input type="text" id="custName" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" id="custEmail" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Phone Number</label>
              <input type="tel" id="custPhone" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-success w-100">Confirm Order</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    const productList = document.getElementById('productList');
    const cartBtn = document.getElementById('cartBtn');
    const cartSidebar = document.getElementById('cartSidebar');
    const closeCart = document.getElementById('closeCart');
    const count = document.getElementById('count');
    const cartItem = document.getElementById('cartItem');
    const totalDisplay = document.getElementById('total');

    let products = JSON.parse(localStorage.getItem('products')) || [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Display Products
    function displayProducts() {
      productList.innerHTML = '';
      if (products.length === 0) {
        productList.innerHTML = '<p class="text-center text-muted">No products available yet!</p>';
        return;
      }
      products.forEach((p, i) => {
        productList.innerHTML += `
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="card h-100 text-center shadow-sm">
              <img src="${p.image}" class="card-img-top" alt="${p.name}" style="height:200px;object-fit:cover;">
              <div class="card-body">
                <h5>${p.name}</h5>
                <p class="text-success fw-bold">₹${p.price}</p>
                <p class="text-muted small">${p.description || ''}</p>
                <button class="btn btn-warning btn-sm" onclick="addToCart(${i})">
                  <i class="fa-solid fa-cart-shopping"></i> Add to Cart
                </button>
              </div>
            </div>
          </div>
        `;
      });
    }

    // Add to Cart
    function addToCart(index) {
      cart.push(products[index]);
      localStorage.setItem('cart', JSON.stringify(cart));
      displayCart();
    }

    // Display Cart
    function displayCart() {
      cartItem.innerHTML = '';
      let total = 0;
      if (cart.length === 0) {
        cartItem.innerHTML = '<p class="text-center text-muted">Your cart is empty.</p>';
        totalDisplay.textContent = '₹0';
        count.textContent = '0';
        return;
      }
      cart.forEach((item, i) => {
        total += Number(item.price);
        cartItem.innerHTML += `
          <div class="cart-item">
            <img src="${item.image}" alt="${item.name}">
            <div>
              <p>${item.name}</p>
              <small>₹${item.price}</small>
            </div>
            <i class="fa-solid fa-trash text-danger" onclick="removeFromCart(${i})"></i>
          </div>
        `;
      });
      totalDisplay.textContent = '₹' + total;
      count.textContent = cart.length;
    }

    // Remove Cart Item
    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      displayCart();
    }

    // Checkout
    function checkout() {
      if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
      }
      const modal = new bootstrap.Modal(document.getElementById('checkoutModal'));
      modal.show();
    }

    // Save Order
    document.getElementById('checkoutForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('custName').value;
      const email = document.getElementById('custEmail').value;
      const phone = document.getElementById('custPhone').value;
      const total = cart.reduce((sum, item) => sum + Number(item.price), 0);

      const order = {
        id: Date.now(),
        name, email, phone,
        items: cart,
        total,
        date: new Date().toLocaleString(),
        status: 'Pending'
      };

      let orders = JSON.parse(localStorage.getItem('orders')) || [];
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));

      // Store customers for admin view
      let customers = JSON.parse(localStorage.getItem('customers')) || [];
      if (!customers.some(c => c.email === email)) {
        customers.push({ name, email, phone });
        localStorage.setItem('customers', JSON.stringify(customers));
      }

     alert('✅ Order placed successfully!\nTHANK YOU!\nVisit again\nKrushna super shopee');
      cart = [];
      localStorage.setItem('cart', JSON.stringify(cart));
      displayCart();

      bootstrap.Modal.getInstance(document.getElementById('checkoutModal')).hide();
    });

    // Sidebar toggle
    cartBtn.addEventListener('click', () => cartSidebar.classList.add('open'));
    closeCart.addEventListener('click', () => cartSidebar.classList.remove('open'));

    displayProducts();
    displayCart();
  </script>
</body>
</html>
